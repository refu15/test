<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            font-size: 2em; /* 文字の大きさを2倍に設定 */
        }
        
        #start {
            color: blue; /* Game Clear! の文字を青色に設定 */
        }

        button {
            margin-top: 10px;
            font-size: 1em;
            padding: 10px 20px;
        }
    </style>
    <script>
        let Q=["printf();","scanf();","1029384756","4<6","*p->a","structstudent{charname;};"];
        let Q_No = Math.floor(Math.random() * Q.length);
        let Q_i = 0;
        let Q_l = Q[Q_No].length;

        let completedQuestions = new Set();
        let mistakeCount = 0;

        let totalQuestions = Q.length;
        let remainingQuestions = totalQuestions;

        let timeLimit = 60; 
        let timer;

        // Enterキーが押されたときにゲームを開始する
        window.addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                startGame();
            }
        });

        function startGame() {
            document.removeEventListener("keydown", startGame); // ゲームが始まったらリスナーを削除する

            // タイマーのカウントダウンを開始する
            timer = setInterval(function() {
                timeLimit--;
                if (timeLimit <= 0) {
                    clearInterval(timer);
                    document.getElementById("start").innerHTML = "Game Over!";
                    displayRestartButton();
                }
                document.getElementById("timer").innerHTML = "Time left: " + timeLimit + " seconds";
            }, 1000);

            // 最初の問題を表示する
            document.getElementById("start").innerHTML = Q[Q_No].substring(Q_i, Q_l);

            // 残りの問題数を更新して表示する
            remainingQuestions = totalQuestions - completedQuestions.size;
            document.getElementById("remaining").innerHTML = "Remaining questions: " + remainingQuestions;

            // キーボードのリスナーを追加する
            window.addEventListener("keydown", push_Keydown);
        }

        function push_Keydown(event) {
            if (completedQuestions.has(Q_No) || timeLimit <= 0) {
                return; // Game Clear後やゲームオーバー時は入力を無視する
            }

            let keyCode = event.key;

            // Shiftキーが押された場合は何もしない
            if (keyCode === "Shift") {
                return;
            }

            if (Q[Q_No].charAt(Q_i) == keyCode) {
                Q_i++;
                document.getElementById("start").innerHTML = Q[Q_No].substring(Q_i, Q_l);

                if (Q_l - Q_i === 0) {
                    completedQuestions.add(Q_No);
                    if (completedQuestions.size === totalQuestions) {
                        document.getElementById("start").innerHTML = "<span id='gameClear'>Game Clear!</span>";
                        clearInterval(timer);
                        remainingQuestions = 0; // 残りの問題数を0に設定
                        document.getElementById("remaining").innerHTML = "Remaining questions: " + remainingQuestions;
                        displayRestartButton();
                    } else {
                        Q_No = Math.floor(Math.random() * Q.length);
                        while (completedQuestions.has(Q_No)) {
                            Q_No = Math.floor(Math.random() * Q.length);
                        }
                        Q_i = 0;
                        Q_l = Q[Q_No].length;
                        document.getElementById("start").innerHTML = Q[Q_No].substring(Q_i, Q_l);

                        // 残りの問題数を更新して表示する
                        remainingQuestions = totalQuestions - completedQuestions.size;
                        document.getElementById("remaining").innerHTML = "Remaining questions: " + remainingQuestions;
                    }
                }
            } else {
                // Shiftキー以外の入力ミスをカウントする
                if (event.key.length === 1) { // 文字キーの場合のみカウント
                    mistakeCount++;
                    document.getElementById("mistake").innerHTML = "入力ミスです。合計" + mistakeCount + "回ミスしました。";
                }
            }
        }

        function displayRestartButton() {
            let button = document.createElement("button");
            button.textContent = "ゲームを最初からやり直す";
            button.onclick = function() {
                location.reload(); // ページをリロードしてゲームを最初からやり直す
            };
            document.body.appendChild(button);
        }
    </script>
</head>
<body>
    <h1 id="start">Enterキーを押してゲームを始めてください!</h1>
    <p id="mistake">ミスの回数がここで出力されます。</p>
    <p id="timer">ゲームが始まると、タイマーのカウントダウンも始まります。</p>
    <p id="remaining">Remaining questions: 6</p>
</body>
</html>
